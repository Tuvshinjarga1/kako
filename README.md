# Kako.mn AI Chatbot - Google Gemini Vision + –ó—É—Ä–∞–≥ —Ö–∞—Ä—å—Ü—É—É–ª–∞—Ö —Å–∏—Å—Ç–µ–º

–≠–Ω—ç –±–æ–ª –æ–Ω–ª–∞–π–Ω –¥—ç–ª–≥“Ø“Ø—Ä–∏–π–Ω AI —Ç—É—Å–ª–∞—Ö –±–æ—Ç —é–º. Google Gemini 2.5 Flash –∞—à–∏–≥–ª–∞–Ω –º–æ–Ω–≥–æ–ª —Ö—ç–ª–∏–π–≥ —Å–∞–π–Ω –æ–π–ª–≥–æ–¥–æ–≥, –∑—É—Ä–≥–∏–π–≥ —Ç–∞–Ω–∏–¥–∞–≥, —Ö—É—Ä–¥–∞–Ω —Ö–∞—Ä–∏—É–ª—Ç ”©–≥–¥”©–≥. **–®–∏–Ω—ç –±–æ–ª–æ–º–∂**: Crawl —Ö–∏–π—Å—ç–Ω –∑—É—Ä–≥—É—É–¥—Ç–∞–π —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∏–ª–≥—ç—ç—Å—ç–Ω –∑—É—Ä–≥–∏–π–≥ —Ö–∞—Ä—å—Ü—É—É–ª–∂ –∏–∂–∏–ª —Ç”©—Å—Ç—ç–π –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω –æ–ª–¥–æ–≥!

## üöÄ –û–Ω—Ü–ª–æ–≥ —à–∏–Ω–∂ —á–∞–Ω–∞—Ä—É—É–¥

- **Google Gemini 2.5 Flash**: Google-–∏–π–Ω —Ö–∞–º–≥–∏–π–Ω —Å“Ø“Ø–ª–∏–π–Ω “Ø–µ–∏–π–Ω multimodal –∑–∞–≥–≤–∞—Ä –∞—à–∏–≥–ª–∞–Ω –º–æ–Ω–≥–æ–ª —Ö—ç–ª–∏–π–≥ –º–∞—à —Å–∞–π–Ω –æ–π–ª–≥–æ–¥–æ–≥
- **üñºÔ∏è –ó—É—Ä–∞–≥ —Ç–∞–Ω–∏–Ω –º—ç–¥—ç—Ö**: –•—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å –∏—Ä—Å—ç–Ω –∑—É—Ä–≥–∏–π–≥ —Ç–∞–Ω–∏–Ω –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω–∏–π –º—ç–¥—ç—ç–ª—ç–ª ”©–≥–¥”©–≥
- **üîÑ –ó—É—Ä–∞–≥ —Ö–∞—Ä—å—Ü—É—É–ª–∞—Ö**: –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∏–ª–≥—ç—ç—Å—ç–Ω –∑—É—Ä–∞–≥—Ç–∞–π –∏–∂–∏–ª —Ç”©—Å—Ç—ç–π –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω–∏–π–≥ crawl —Ö–∏–π—Å—ç–Ω –∑—É—Ä–≥—É—É–¥–∞–∞—Å –æ–ª–¥–æ–≥
- **Multimodal**: –¢–µ–∫—Å—Ç –±–æ–ª–æ–Ω –∑—É—Ä–∞–≥ —Ö–æ—ë—É–ª–∞–Ω–≥ –Ω—ç–≥ –∑—ç—Ä—ç–≥ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–¥–∞–≥
- **–í–µ–±—Å–∞–π—Ç crawling**: –ê–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –≤–µ–±—Å–∞–π—Ç—ã–Ω –∞–≥—É—É–ª–≥–∞ –±–æ–ª–æ–Ω –∑—É—Ä–≥—É—É–¥—ã–≥ —Ç–∞—Ç–∞–∂ —Ö–∞–¥–≥–∞–ª–¥–∞–≥
- **Chatwoot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏**: Chatwoot widget-—Ç—ç–π —Ö–æ–ª–±–æ–≥–¥–æ–Ω–æ
- **RAG —Å–∏—Å—Ç–µ–º**: Crawl —Ö–∏–π—Å—ç–Ω –º—ç–¥—ç—ç–ª–ª—ç—ç—Å —Ö–∞–º–≥–∏–π–Ω —Ö–æ–ª–±–æ–≥–¥–æ—Ö—Ç–æ–π –∞–≥—É—É–ª–≥—ã–≥ –æ–ª–∂ AI-–¥ ”©–≥–¥”©–≥
- **Image Database**: –ó—É—Ä–≥–∏–π–Ω –º—ç–¥—ç—ç–ª–ª–∏–π–Ω —Å–∞–Ω “Ø“Ø—Å–≥—ç–∂, ”©–Ω–≥”©–Ω–∏–π histogram –∞—à–∏–≥–ª–∞–Ω —Ö–∞—Ä—å—Ü—É—É–ª–¥–∞–≥

## üìã –®–∞–∞—Ä–¥–ª–∞–≥–∞

- Python 3.9+
- Google Gemini API —Ç“Ø–ª—Ö“Ø“Ø—Ä
- Docker (—Å–æ–Ω–≥–æ–ª—Ç—Ç–æ–π)

## üîß –°—É—É–ª–≥–∞—Ö –∑–∞–∞–≤–∞—Ä

### 1. Repository clone —Ö–∏–π—Ö

```bash
git clone <repository-url>
cd kako
```

### 2. Virtual environment “Ø“Ø—Å–≥—ç—Ö

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 3. Dependencies —Å—É—É–ª–≥–∞—Ö

```bash
pip install -r requirements.txt
```

### 4. Google Gemini API —Ç“Ø–ª—Ö“Ø“Ø—Ä –∞–≤–∞—Ö

1. [Google AI Studio](https://aistudio.google.com/app/apikey) —Ä—É—É –æ—Ä–Ω–æ —É—É
2. "Create API key" –¥—ç—ç—Ä –¥–∞—Ä–∂ —à–∏–Ω—ç API key “Ø“Ø—Å–≥—ç–Ω—ç “Ø“Ø
3. API key-–≥ –∞—é—É–ª–≥“Ø–π –≥–∞–∑–∞—Ä —Ö–∞–¥–≥–∞–ª–Ω–∞ —É—É

### 5. Environment variables —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö

`.env` —Ñ–∞–π–ª “Ø“Ø—Å–≥—ç–∂ –¥–∞—Ä–∞–∞—Ö –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É:

```bash
# –û–Ω–ª–∞–π–Ω –¥—ç–ª–≥“Ø“Ø—Ä–∏–π–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ
ROOT_URL=https://kako.mn/
MAX_CRAWL_PAGES=500
AUTO_CRAWL_ON_START=true
DELAY_SEC=0.5

# Google Gemini API —Ç–æ—Ö–∏—Ä–≥–æ–æ (–∑—É—Ä–∞–≥ —Ç–∞–Ω–∏—Ö —á–∞–¥–≤–∞—Ä—Ç–∞–π)
GEMINI_API_KEY=your_google_gemini_api_key

# Chatwoot —Ç–æ—Ö–∏—Ä–≥–æ–æ
CHATWOOT_API_KEY=your_chatwoot_api_key
ACCOUNT_ID=your_account_id
CHATWOOT_BASE_URL=https://app.chatwoot.com/
```

### 6. –ê–ø–ø–ª–∏–∫–µ–π—à–Ω –∞–∂–∏–ª–ª—É—É–ª–∞—Ö

```bash
python main.py
```

–≠—Å–≤—ç–ª Docker –∞—à–∏–≥–ª–∞–Ω:

```bash
docker build -t kako-chatbot .
docker run -p 8000:8000 --env-file .env kako-chatbot
```

## üî• –®–∏–Ω—ç –±–æ–ª–æ–º–∂—É—É–¥

### üì∏ –ó—É—Ä–∞–≥ —Ç–∞–Ω–∏–Ω –º—ç–¥—ç—Ö (Google Gemini Vision)

–•—ç—Ä—ç–≥–ª—ç–≥—á Chatwoot widget –¥—ç—ç—Ä –∑—É—Ä–∞–≥ –∏–ª–≥—ç—ç—Ö—ç–¥, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä:

- –ó—É—Ä–∞–≥—Ç —Ö–∞—Ä–∞–≥–¥–∞–∂ –±–∞–π–≥–∞–∞ –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–Ω–æ
- –ó–∞–≥–≤–∞—Ä, ”©–Ω–≥”©, –º–∞—Ç–µ—Ä–∏–∞–ª—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª ”©–≥–Ω”©
- “Æ–Ω—ç –±–æ–ª–æ–Ω —Ö—É–¥–∞–ª–¥–∞–Ω –∞–≤–∞—Ö –º—ç–¥—ç—ç–ª—ç–ª —Ö–∞–π–∂ –æ–ª–Ω–æ
- –ò–∂–∏–ª —Ç”©—Å—Ç—ç–π –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω —Å–∞–Ω–∞–ª –±–æ–ª–≥–æ–Ω–æ
- Object detection –±–æ–ª–æ–Ω segmentation —Ö–∏–π–¥—ç–≥

### üîÑ –ó—É—Ä–∞–≥ —Ö–∞—Ä—å—Ü—É—É–ª–∞—Ö —Å–∏—Å—Ç–µ–º (–®–ò–ù–≠!)

**Crawl —Ö–∏–π—Å—ç–Ω –∑—É—Ä–≥—É—É–¥—Ç–∞–π —Ö–∞—Ä—å—Ü—É—É–ª–∞—Ö**:

- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∏–ª–≥—ç—ç—Å—ç–Ω –∑—É—Ä–∞–≥—Ç–∞–π –∏–∂–∏–ª —Ç”©—Å—Ç—ç–π –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω–∏–π–≥ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –æ–ª–¥–æ–≥
- ”®–Ω–≥”©–Ω–∏–π histogram –∞—à–∏–≥–ª–∞–Ω –∑—É—Ä–≥–∏–π–Ω –∏–∂–ª—ç—ç —Ç–æ–æ—Ü–¥–æ–≥
- Similarity threshold: 20% (—Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö –±–æ–ª–æ–º–∂—Ç–æ–π)
- –•–∞–º–≥–∏–π–Ω –æ–π—Ä–æ–ª—Ü–æ–æ 3 –∑—É—Ä–≥–∏–π–≥ –æ–ª–∂ AI-–¥ –º—ç–¥—ç—ç–ª—ç–ª ”©–≥–¥”©–≥

**–ê–∂–∏–ª–ª–∞—Ö –∑–∞—Ä—á–∏–º**:

1. Crawl —Ö–∏–π—Ö—ç–¥ –±“Ø—Ö –∑—É—Ä–≥–∏–π–≥ —Ç–∞—Ç–∞–∂ `crawled_images/` folder-—Ç —Ö–∞–¥–≥–∞–ª–Ω–∞
2. –ó—É—Ä–∞–≥ —Ç—É—Å –±“Ø—Ä—ç—ç—Å ”©–Ω–≥”©–Ω–∏–π histogram –≥–∞—Ä–≥–∞–Ω–∞ (RGB –∫–∞–Ω–∞–ª—É—É–¥)
3. –•—ç—Ä—ç–≥–ª—ç–≥—á –∑—É—Ä–∞–≥ –∏–ª–≥—ç—ç—Ö—ç–¥, Chi-squared distance –∞—à–∏–≥–ª–∞–Ω —Ö–∞—Ä—å—Ü—É—É–ª–Ω–∞
4. –•–∞–º–≥–∏–π–Ω –∏–∂–∏–ª —Ç”©—Å—Ç—ç–π 3 –∑—É—Ä–≥–∏–π–Ω —Ö—É—É–¥–∞—Å–Ω—ã –º—ç–¥—ç—ç–ª–ª–∏–π–≥ AI-–¥ ”©–≥–Ω”©

### üß† RAG (Retrieval-Augmented Generation) —Å–∏—Å—Ç–µ–º

- Crawl —Ö–∏–π—Å—ç–Ω –º—ç–¥—ç—ç–ª–ª—ç—ç—Å —Ö–∞–º–≥–∏–π–Ω —Ö–æ–ª–±–æ–≥–¥–æ—Ö—Ç–æ–π –∞–≥—É—É–ª–≥—ã–≥ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä —Ö–∞–π–¥–∞–≥
- Semantic search –∞—à–∏–≥–ª–∞–Ω –º–æ–Ω–≥–æ–ª —Ö—ç–ª—ç—ç—Ä —Ö–∞–π–ª—Ç —Ö–∏–π–¥—ç–≥
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –º—ç–¥—ç—ç–ª–ª–∏–π–≥ AI-–¥ ”©–≥—á –∏–ª“Ø“Ø –Ω–∞—Ä–∏–π–≤—á–ª–∞–ª—Ç–∞–π —Ö–∞—Ä–∏—É–ª—Ç –∞–≤–¥–∞–≥

### üîß API Endpoints

#### –°–∏—Å—Ç–µ–º–∏–π–Ω —Ç”©–ª”©–≤ —à–∞–ª–≥–∞—Ö

```bash
GET /health
```

#### –•–∞–π–ª—Ç —Ö–∏–π—Ö

```bash
POST /api/search
{
  "query": "—Ö–∞–π—Ö “Ø–≥",
  "max_results": 5
}
```

#### Crawl-–∏–π–Ω —Ç”©–ª”©–≤ —à–∞–ª–≥–∞—Ö

```bash
GET /api/crawl-status
```

#### –®–∏–Ω—ç crawl —ç—Ö–ª“Ø“Ø–ª—ç—Ö

```bash
POST /api/force-crawl
```

#### Crawl —Ö–∏–π—Å—ç–Ω –∑—É—Ä–≥—É—É–¥—ã–≥ —Ö–∞—Ä–∞—Ö

```bash
GET /api/crawled-images?limit=20
```

#### –ó—É—Ä–∞–≥ —Ö–∞—Ä—å—Ü—É—É–ª–∞—Ö (API)

```bash
POST /api/similar-images
Content-Type: multipart/form-data

# Form data:
image: [image file]
threshold: 0.3  # optional, default 0.3
```

#### –ó—É—Ä–≥–∏–π–Ω –º—ç–¥—ç—ç–ª–ª–∏–π–Ω —Å–∞–Ω–≥ —Ü—ç–≤—ç—Ä–ª—ç—Ö

```bash
POST /api/clear-images
```

#### –ó—É—Ä–∞–≥ “Ø–∑—ç—Ö

```bash
GET /images/[filename]
```

## üõ†Ô∏è –¢–æ—Ö–∏—Ä–≥–æ–æ

### GEMINI_API_KEY

Google Gemini API —Ç“Ø–ª—Ö“Ø“Ø—Ä (ai.google.dev-—ç—ç—Å –∞–≤–∞—Ö)

### MAX_CRAWL_PAGES

Crawl —Ö–∏–π—Ö —Ö—É—É–¥–∞—Å–Ω—ã —Ç–æ–æ (default: 500)

### AUTO_CRAWL_ON_START

–ê–ø–ø–ª–∏–∫–µ–π—à–Ω —ç—Ö–ª—ç—Ö—ç–¥ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä crawl —Ö–∏–π—Ö —ç—Å—ç—Ö (default: true)

## üêõ –ê–ª–¥–∞–∞ –∑–∞—Å–∞—Ö

### Gemini API –∞–ª–¥–∞–∞

```bash
# API key —à–∞–ª–≥–∞—Ö
echo $GEMINI_API_KEY

# API quota —à–∞–ª–≥–∞—Ö (Google AI Studio –¥—ç—ç—Ä)
```

### Docker –∞–ª–¥–∞–∞

```bash
# Container logs —à–∞–ª–≥–∞—Ö
docker logs kako-chatbot

# Container –¥–æ—Ç–æ—Ä –æ—Ä–æ—Ö
docker exec -it kako-chatbot bash
```

## üìù –¢–µ—Ö–Ω–∏–∫–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π

### Google Gemini-–∏–π–Ω –¥–∞–≤—É—É —Ç–∞–ª—É—É–¥

- **Multimodal**: –ó—É—Ä–∞–≥ –±–æ–ª–æ–Ω —Ç–µ–∫—Å—Ç–∏–π–≥ –Ω—ç–≥ –∑—ç—Ä—ç–≥ –æ–π–ª–≥–æ–¥–æ–≥
- **–•—É—Ä–¥–∞–Ω**: OpenAI-–æ–æ—Å –∏–ª“Ø“Ø —Ö—É—Ä–¥–∞–Ω response
- **“Æ–Ω—ç —Ö—è–º–¥**: Token “Ø–Ω—ç –∏–ª“Ø“Ø —Ö—è–º–¥
- **–ú–æ–Ω–≥–æ–ª —Ö—ç–ª**: –ú–æ–Ω–≥–æ–ª —Ö—ç–ª–∏–π–≥ —Å–∞–π–Ω –¥—ç–º–∂–¥—ç–≥
- **Vision —á–∞–¥–≤–∞—Ä**: –ó—É—Ä–∞–≥ —Ç–∞–Ω–∏–Ω –º—ç–¥—ç—Ö —á–∞–¥–≤–∞—Ä ”©–Ω–¥”©—Ä

### –î—ç–º–∂–∏–≥–¥—ç—Ö –∑—É—Ä–≥–∏–π–Ω —Ñ–æ—Ä–º–∞—Ç—É—É–¥

- PNG - `image/png`
- JPEG - `image/jpeg`
- WebP - `image/webp`
- HEIC - `image/heic`
- HEIF - `image/heif`

### Code structure

```
‚îú‚îÄ‚îÄ main.py              # “Æ–Ω–¥—Å—ç–Ω Flask –∞–ø–ø–ª–∏–∫–µ–π—à–Ω
‚îú‚îÄ‚îÄ requirements.txt     # Python dependencies
‚îú‚îÄ‚îÄ Dockerfile          # Docker —Ç–æ—Ö–∏—Ä–≥–æ–æ
‚îú‚îÄ‚îÄ env.example         # Environment variables –∂–∏—à—ç—ç
‚îî‚îÄ‚îÄ README.md           # –≠–Ω—ç —Ñ–∞–π–ª
```

### –®–∏–Ω—ç —Ñ—É–Ω–∫—Ü –Ω—ç–º—ç—Ö

1. `main.py` —Ñ–∞–π–ª–¥ —Ñ—É–Ω–∫—Ü –Ω—ç–º–Ω—ç “Ø“Ø
2. Route –Ω—ç–º—ç—Ö –±–æ–ª `@app.route` decorator –∞—à–∏–≥–ª–∞–Ω–∞ —É—É
3. AI logic ”©”©—Ä—á–ª”©—Ö –±–æ–ª `get_ai_response` —Ñ—É–Ω–∫—Ü–∏–π–≥ –∑–∞—Å–Ω–∞ —É—É
4. –ó—É—Ä–∞–≥ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö –±–æ–ª `process_chatwoot_attachment` —Ñ—É–Ω–∫—Ü–∏–π–≥ –∑–∞—Å–Ω–∞ —É—É

## üñºÔ∏è –ó—É—Ä–∞–≥ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö

### –ñ–∏—à—ç—ç –∞—à–∏–≥–ª–∞–ª—Ç

1. Chatwoot widget –¥—ç—ç—Ä –∑—É—Ä–∞–≥ upload —Ö–∏–π—Ö
2. "–≠–Ω—ç —é—É –≤—ç?" –≥—ç–∂ –∞—Å—É—É—Ö —ç—Å–≤—ç–ª –∑—É—Ä–∞–≥ –ª –∏–ª–≥—ç—ç—Ö
3. Gemini AI –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –∑—É—Ä–≥–∏–π–≥ —à–∏–Ω–∂–∏–ª–∂ —Ö–∞—Ä–∏—É–ª—Ç ”©–≥–Ω”©

### –ó—É—Ä–≥–∏–π–Ω —Ö—è–∑–≥–∞–∞—Ä–ª–∞–ª—Ç—É—É–¥

- –ù–∏–π—Ç request —Ö—ç–º–∂—ç—ç: 20MB
- –ó—É—Ä–≥–∏–π–Ω —Ç–æ–æ: Request —Ç—É—Ç–∞–º–¥ 3,600 —Ö“Ø—Ä—Ç—ç–ª
- –ó—É—Ä–≥–∏–π–Ω —Ö—ç–º–∂—ç—ç: –ê–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –æ–ø—Ç–∏–º–∞–ª—å—á–ª–∞–≥–¥–∞–Ω–∞

## üöÄ Performance

- **Token —Ç–æ–æ—Ü–æ–æ–ª–æ–ª**: 384px —Ö“Ø—Ä—Ç—ç–ª –∑—É—Ä–∞–≥ 258 token
- **Response —Ö—É–≥–∞—Ü–∞–∞**: –ò—Ö—ç–Ω—Ö–¥—ç—ç 2-5 —Å–µ–∫—É–Ω–¥
- **Crawl —Ö—É—Ä–¥**: –°–µ–∫—É–Ω–¥—ç–¥ 2 —Ö—É—É–¥–∞—Å (DELAY_SEC —Ç–æ—Ö–∏—Ä–≥–æ–æ–Ω–æ–æ—Å —Ö–∞–º–∞–∞—Ä–Ω–∞)

## ü§ù –•—É–≤—å –Ω—ç–º—ç—Ä –æ—Ä—É—É–ª–∞—Ö

1. Fork —Ö–∏–π–Ω—ç “Ø“Ø
2. Feature branch “Ø“Ø—Å–≥—ç–Ω—ç “Ø“Ø
3. Changes —Ö–∏–π–Ω—ç “Ø“Ø
4. Test —Ö–∏–π–Ω—ç “Ø“Ø
5. Pull request –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø

## üìû –¢—É—Å–ª–∞–º–∂

- –ê—Å—É—É–¥–∞–ª—Ç–∞–π –±–æ–ª GitHub Issues –∞—à–∏–≥–ª–∞–Ω–∞ —É—É
- Google Gemini API: [ai.google.dev](https://ai.google.dev)
- Chatwoot setup: [chatwoot.com](https://chatwoot.com)
